#version 400 core
uniform int firstVisibleLine;
uniform int lastVisibleLine;
uniform int topVisibleLayer;
uniform int bottomVisibleLayer;
uniform int showFlags; // 1 = show moves. 2 = show t0, 4 = show t1, 8 = show type.
uniform vec3 t0Colour;
uniform vec3 t1Colour;

in vec3 position;
in vec4 direction;
in vec4 normal;
in vec3 colour;
in vec4 attributes; // x = 0, y = layer, z = line, w = tool

out vec4 vDirection;
out vec4 vNormal;
out vec4 vColour;

void main(void) {
    gl_Position = vec4(position, 1.0);
	vDirection = direction;
	vNormal = normal;
	
	if ((showFlags & 8) == 8)
		vColour.rgb = colour;
	else if (attributes.w == 0)
		vColour.rgb = t0Colour;
	else
		vColour.rgb = t1Colour;
		
	bool showTool = (attributes.x == 0 &&
					 (((showFlags & 2) == 2 && attributes.w == 0) ||
					  ((showFlags & 4) == 4 && attributes.w == 1)));
	if (showTool &&
     	(attributes.y >= bottomVisibleLayer && attributes.y <= topVisibleLayer) &&
     	(attributes.z >= firstVisibleLine && attributes.z <= lastVisibleLine))
		vColour.a = 1.0;
	else
		vColour.a = 0.0;
}
